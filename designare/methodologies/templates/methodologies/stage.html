{% load designare_tags %}
<div class="collapse show pt-5" id="stage-{{ stage.pk }}">
    <div class='row'>
        <div class='col'>
            <div class='card card-outline-secondary border-square'>
                <div class='card-body mb-0 collapse show' id="stage-{{ stage.pk }}-card-info">
                    <div class="dropdown float-right">
                        <button 
                            class="btn btn-light dropdown-toggle border-square" type="button"
                            id="stage-{{ stage.pk }}-menu" data-toggle="dropdown" 
                            aria-haspopup="true" aria-expanded="false"
                        >
                            <i class="fa fa-cog"></i>
                        </button>
                            <div class="dropdown-menu dropdown-menu-right border-square" aria-labelledby="stage-{{ stage.pk }}-menu">
                            <button class="dropdown-item" type="button">Alterar nome</button>
                            <button
                                class="dropdown-item" type="button" 
                                onclick="Designare.Methodologies.Methodology.ShowModalDeleteObject('stage',{{ stage.pk }},'{{ stage.name }}');"
                            >Excluir</button>
                            <button class="dropdown-item disabled" type="button" disabled>Definir Permissões</button>
                        </div>
                    </div>
                    <h3 class='card-title' id="stage-{{ stage.pk }}-name">{{ stage.name }}</h3>
                    <p class='card-text'>
                        <div id="stage-{{ stage.pk }}-description">
                            {% if stage.description %}
                                {{ stage.description | safe }}
                            {% else %}
                                <i>Nenhuma descrição fornecida para esta etapa!</i>
                            {% endif %}
                        </div>
                    </p>
                </div>
                <div id='div-stage-{{ stage.pk }}-activities-list' class="collapse show">
                    {% if stage.ordered_activities %}
                        {% for activity in stage.ordered_activities %}
                            {% include "methodologies/activity.html" with activity=activity %}
                        {% endfor %}
                    {% endif %}
                    <div class='row ml-1 collapse show' id='row-stage-{{ stage.pk }}-btn-new-activity'>
                        <div class='col mb-2'>
                           <button class='btn btn-light border-dark border-square'>
                                    Adicionar Atividade <i class='fa fa-plus'></i>
                            </button>
                        </div>
                    </div>
                    <div class='row collapse mb-3' id='row-stage-{{ stage.pk }}-form'>
                        <div class='col-md-11 ml-auto'>
                            <h4 class='mt-3'>Adicionar nova atividade:</h4>
                            <form id='form-stage-{{ stage.pk }}' name='form_stage_{{ stage.pk }}'>
                                <fieldset id='fieldset-stage-{{ stage.pk }}'>
                                    {% csrf_token %}
                                    <div class='form-group mr-3' id='div-input-stage-{{ stage.pk }}-object-name'>
                                        <label for="input-stage-{{ stage.pk }}-object-name"><b>Nome</b></label>
                                        <div class='input-group'>
                                            <span class='input-group-addon border-square'>
                                                <i class='fa fa-tag'></i>
                                            </span>
                                            <input name='name' 
                                                type='text'
                                                class='form-control border-square'
                                                placeholder='Minha Atividade'
                                                id='input-stage-{{ stage.pk }}-activity-new-name' 
                                            >
                                        </div>
                                    </div>
                                    <label><b>Descrição</b></label>
                                    <div>
                                        {% with "input-stage-activity-new-description-"|addstr:stage.pk as id %}
                                            {% include "utils/components/editor-wysiwyg.html" with editor_id=id %}
                                        {% endwith %}
                                    </div>
                                    <p class='form-text text-muted'>
                                        Forneça uma descrição para auxiliar membros da equipe a identificar o propósito de cada atividade ou facilitar o aprendizado de novos membros. 
                                    </p>
                                    <br>
                                    <div align='center'>
                                        <button 
                                            type='button' class='btn btn-danger border-square' 
                                            id='btn-stage-{{ stage.pk }}-activity-new-cancel'
                                            onclick='CancelarCadastrarAtividade("{{ stage.pk}}")' 
                                        >
                                            Cancelar
                                        </button>
                                        <button 
                                            type='button' class='btn btn-success border-square' 
                                            id='btn-stage-{{ stage.pk }}-activity-new-confirm'
                                            onclick='CadastrarAtividade("{{ stage.pk}}")' 
                                        >
                                            Cadastrar Atividade
                                        </button>
                                    </div>
                                </fieldset>                                
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='row my-2'></div>
</div>